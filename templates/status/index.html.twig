{% extends 'base.html.twig' %}

{% block title %}Sensorstatus – Verlauf{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('css/status.css') }}">
{% endblock %}

{% block body %}
{% set currentPage = 'status' %}

<div class="page page--status">
  <header class="page__header">
    <a href="{{ path('app_home') }}" class="page__logo">
      <span class="page__logo-mark">SH</span>
      <span class="page__logo-text">
        <strong>SmartHome</strong>
        <small>Prototype</small>
      </span>
    </a>
    <nav class="page__nav" aria-label="Hauptnavigation">
      <a href="{{ path('app_home') }}"   class="page__nav-link">Übersicht</a>
      <a href="{{ path('app_status') }}" class="page__nav-link is-active" aria-current="page">Status</a>
    </nav>
  </header>

  <main class="page__main">
    <section class="section-heading">
      <span class="badge">Live-Daten</span>
      <h1>Werte deiner Umgebung</h1>
      <p>Die Werte werden <strong>jede Sekunde automatisch aktualisiert</strong> und stammen <strong>direkt live von deinem Raspberry&nbsp;Pi</strong>.</p>
    </section>

    {# Kacheln #}
    <section class="status-metrics">
      <div class="status-metrics__grid">
        <article class="metric-card">
          <header class="metric-card__header">
            <span class="metric-card__label">Temperatur</span>
            <p>Aktuelle Lufttemperatur.</p>
          </header>
          <div class="metric-card__value">
            {% if temperature is not null %}
              <strong id="metric-temperature">{{ temperature|number_format(2, '.', '') }}</strong><span>°C</span>
            {% else %}
              <strong id="metric-temperature">—</strong><span>°C</span>
            {% endif %}
          </div>
        </article>

        <article class="metric-card">
          <header class="metric-card__header">
            <span class="metric-card__label">Relative Luftfeuchte</span>
            <p>Feuchte deiner Umgebung.</p>
          </header>
          <div class="metric-card__value">
            {% if humidity is not null %}
              <strong id="metric-humidity">{{ humidity|number_format(2, '.', '') }}</strong><span>%</span>
            {% else %}
              <strong id="metric-humidity">—</strong><span>%</span>
            {% endif %}
          </div>
        </article>

        <article class="metric-card">
          <header class="metric-card__header">
            <span class="metric-card__label">Luftdruck</span>
            <p>Atmosphärischer Druck.</p>
          </header>
          <div class="metric-card__value">
            {% if pressure is not null %}
              <strong id="metric-pressure">{{ pressure|number_format(2, '.', '') }}</strong><span>hPa</span>
            {% else %}
              <strong id="metric-pressure">—</strong><span>hPa</span>
            {% endif %}
          </div>
        </article>

        <article class="metric-card">
          <header class="metric-card__header">
            <span class="metric-card__label">Helligkeit</span>
            <p>Lichtstärke.</p>
          </header>
          <div class="metric-card__value">
            {% if brightness is not null %}
              <strong id="metric-brightness">{{ brightness|number_format(2, '.', '') }}</strong><span>Lux</span>
            {% else %}
              <strong id="metric-brightness">—</strong><span>Lux</span>
            {% endif %}
          </div>
        </article>
      </div>
    </section>

    {# Charts + Range-Dropdown #}
    <section class="panel">
      <div class="panel__header">
        <div class="panel__header-row">
          <div>
            <span class="badge">Visualisierung</span>
            <h2>Verlauf</h2>
            <p>Wähle zwischen: <strong>Wochenansicht</strong>, <strong>Tagesansicht</strong>, oder <strong>Stundenansicht</strong>.</p>
          </div>
          <div class="range-select">
            <label for="range-select">Zeitraum:</label>
            <select id="range-select">
              <option value="week">Woche</option>
              <option value="24h">24 h</option>
              <option value="60min" selected>60 min</option>
            </select>
          </div>
        </div>
        <p id="charts-empty" class="charts-empty" hidden>Keine Daten im ausgewählten Zeitraum.</p>
      </div>

      <div class="charts-grid charts-grid--2x2">
        <div class="chart-card">
          <h3>Temperatur (°C)</h3>
          <div class="chart-wrap"><canvas id="chart-temperature"></canvas></div>
        </div>
        <div class="chart-card">
          <h3>Luftfeuchte (%)</h3>
          <div class="chart-wrap"><canvas id="chart-humidity"></canvas></div>
        </div>
        <div class="chart-card">
          <h3>Luftdruck (hPa)</h3>
          <div class="chart-wrap"><canvas id="chart-pressure"></canvas></div>
        </div>
        <div class="chart-card">
          <h3>Helligkeit (Lux)</h3>
          <div class="chart-wrap"><canvas id="chart-brightness"></canvas></div>
        </div>
      </div>
    </section>

    <section class="status-meta">
      <div class="status-meta__item">
        <span>Letztes Update</span>
        <strong id="metric-lastUpdate">{{ lastUpdate|default('—') }}</strong>
      </div>
    </section>
  </main>
</div>

{# Initiale History (für erstes Rendern, default 60min) #}
<script id="history-data" type="application/json">
{{ history|json_encode(constant('JSON_UNESCAPED_UNICODE'))|raw }}
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<script defer src="{{ asset('js/graph.js') }}"></script>
{% endblock %}
